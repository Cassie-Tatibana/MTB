<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <title>{{ '编辑任务' if task else '新建任务' }}</title>
  <style>
    :root {
      --brand: #1677ff;
      --text: #1f2329;
      --muted: #646a73;
      --border: #e5e6eb;
      --bg: #f7f8fa;
    }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin: 24px; background: var(--bg); color: var(--text); }
    .page { max-width: 960px; margin: 0 auto; }
    .card { background:#fff; border:1px solid var(--border); border-radius: 12px; padding: 16px; max-width: 960px; }
    label { display:block; margin-top: 14px; font-weight: 600; }
    input, textarea, select { width: 100%; padding: 10px 12px; margin-top: 6px; box-sizing: border-box; border:1px solid var(--border); border-radius: 8px; }
    textarea { border-radius: 10px; }
    .btn { display: inline-block; padding: 8px 16px; border: 1px solid var(--border); border-radius: 8px; text-decoration: none; color: var(--text); background:#fff; }
    .btn-primary { background: var(--brand); color:#fff; border-color: var(--brand); }
  </style>
  <script>
    function setDefaults() {
      const elMode = document.getElementById('sync_mode');
      if (!elMode.value) elMode.value = 'full';
      const elIndex = document.getElementById('index_column');
      if (!elIndex.value) elIndex.value = 'id';
      const elStrategy = document.getElementById('field_type_strategy');
      if (!elStrategy.value) elStrategy.value = 'base';
      const elCreate = document.getElementById('create_missing_fields');
      if (!elCreate.value) elCreate.value = 'true';
      const elCron = document.getElementById('cron_expr');
      if (!elCron.value) elCron.value = '0 3 * * *';
    }
    window.onload = setDefaults;
  </script>
</head>
<body>
  <div class="page">
    <h2 style="margin:0 0 16px 0;">{{ '编辑任务' if task else '新建任务' }}</h2>
    <div class="card">
  <form method="post">
    <label>任务名称</label>
    <input name="name" value="{{ task.name if task else '' }}" placeholder="例如：商品同步（每日3点）" />

    <label>SQL（MySQL 写死连接，填写查询语句）</label>
    <textarea name="sql_text" rows="8" placeholder="SELECT * FROM your_table LIMIT 1000">{{ task.sql_text if task else '' }}</textarea>

    <label>同步模式（full/incremental/overwrite/clone）</label>
    <input id="sync_mode" name="sync_mode" value="{{ task.sync_mode if task else '' }}" />

    <label>索引列（如 id、sku_code）</label>
    <input id="index_column" name="index_column" value="{{ task.index_column if task else '' }}" />

    <label>字段类型策略（raw/base/auto/intelligence）</label>
    <input id="field_type_strategy" name="field_type_strategy" value="{{ task.field_type_strategy if task else '' }}" />

    <label>是否自动创建缺失字段（true/false）</label>
    <input id="create_missing_fields" name="create_missing_fields" value="{{ 'true' if (task and task.create_missing_fields) else '' }}" />

    <label>飞书链接（多维表格链接），例如：</label>
    <input name="feishu_link" placeholder="https://y0h5gxisibo.feishu.cn/base/<app_token>?table=<tbl...>" value="{{ task.feishu_link if task else '' }}" />

    <label>Cron 表达式（5段，如 0 3 * * * 表示每日 03:00）</label>
    <input id="cron_expr" name="cron_expr" value="{{ task.cron_expr if task else '' }}" />

    <div style="margin-top:16px;">
      <a class="btn" href="/">返回</a>
      <button class="btn btn-primary" type="submit">保存</button>
    </div>
  </form>
    </div>
  </div>
</body>
</html>


